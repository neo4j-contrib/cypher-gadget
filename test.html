<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Gadget Test</title>
    <style type="text/css" media="screen">
        @import url("styles/codemirror.css");
        @import url("styles/cm-cypher.css");
        @import url("styles/base.css");
        @import url("gadget.css");
    </style>

</head>

<body>
<div id="gadget_1"></div>


<script src="libs/jquery.js"></script>
<script src="libs/d3.min.js"></script>
<script src="libs/underscore.js"></script>
<script src="libs/backbone-min.js"></script>
<script src="libs/require.js"></script>
<script type="text/javascript">
    function generateQuickGuid() {
        return Math.random().toString(36).substring(2, 15) +
                Math.random().toString(36).substring(2, 15);
    }
    // todo marketo lead id?
    var uuid = generateQuickGuid();
    require(["gadget", "utils/queryUtils"], function (Gadget, QueryUtils) {
        console.log(uuid, Gadget, typeof(Gadget));
        try {
            var storage = {
                set: function (prop, value) {
                    console.log("storing", prop, value);
                    localStorage.setItem(prop, JSON.stringify(value));
                },
                get: function (prop) {
                    var value = JSON.parse(localStorage.getItem(prop));
                    console.log("retrieving", prop, value);
                    return value;
                }
            };

            var urlConfig = QueryUtils.getQueryParameters(document.location.search);
            urlConfig.cypherSetup = urlConfig.cypherSetup || 'lesson1';
            var configGetFunction = function (prop) {
                return urlConfig[prop] || null;
            };

            var getFunction = function (prop) {
                return null;
            };

            var userState = {gadget: {get: getFunction},
                get: storage.get,
                set: storage.set,
                save: storage.set};

            var g = new Gadget({
                "$el": $("#gadget_1"),
                config: {get: configGetFunction},
                userState: userState});

            g.render();
        } catch (e) {
            console.log(e);
        }
    });
</script>
</body>
</html>

<!--
users-graph
foo
mystic-river-sean
lesson1-knows
lesson1
_lab_paths
mystic-river
full
-->